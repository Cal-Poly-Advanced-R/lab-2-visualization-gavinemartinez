---
title: "Lab 2: Advanced Data Visualization"
author: "Gavin Martinez, Nils Berzins"
date: "2023-04-13"
output: html_document
---

##Lab 2: Advanced Data Visualization

###Part One: Identifying Bad Visualizations

1. While there are certainly issues with this image, do your best to tell the story of this graph in words. That is, what is this graph telling you? What do you think the authors meant to convey with it?

This graph is attempting to describe the various rates of vaccine skepticism (by % of people surveyed believing vaccines are safe) worldwide by looking at individual nations and stratifying them by region. It seems the authors wanted to convey the different distributions present across different regions of the world. 
2. List the variables that appear to be displayed in this visualization.

On the x-axis, there is the % of the country's population that believes vaccines are safe. On the y-axis, it appears to be the index of the country in that region with 1 being the smallest % of believing vaccines are safe. 

3. Now that you're versed in the grammar of graphics (ggplot), list the aesthetics used and which variables are specified for each.

* Aesthetics
  + x = % of those surveyed who believe that vaccines are safe 
  + y = Index of country
  + groups = Region
* Geometry
  + dot plot
  
4. What type of graph would you call this?
A stacked scatter plot, stratified by region?

5. List all of the problems or things you would improve about this graph.

* The stacking leads to the graph being too tall to fit in one screen.
* The height of each corresponding region is associate purely with the number of countries in that region
* The Europe/Former Soviet Union distinction bothers me. Being a proud Latvian, I'm disappointed to see that Wellcome Global Monitor is still identifying my proud country by its former oppressor. This form of categorization (however convenient for the analyst) is antiquated and insensitive to those who have since claimed their own independence from the Soviet Union. 
* There is no mention of what the verticality of the dots means, it is eventually inferrable to be the country index. 
* It would likely make sense to just separate each of these regions into their own separate graphs, then using some sort of graph stacking (maybe "patchwork") to illustrate them all on one page.

### Part Two: Broad Visualization Improvement 
#### Second Data Visualization Improvement
1. Select a data visualization in the report that you think could be improved. Be sure to cite both the page number and figure title. Do your best to tell the story of this graph in words. That is, what is this graph telling you? What do you think the authors meant to convey with it?

 *Chart 4.5: The combined view of how people feel about the benefits of science on a personal and country level, Page 84* 

This chart is describing the four analyzable outcomes between one's views on the extent to which science benefits society and on the extent to which sciecne benefits people normally. The four outcomes are: The Excluded, The Enthusiasts, Skeptics, and The Included. The authors are using proportionately sized circles within these four categorize to in attempt to visually describe which of these four opinions are more popular than the others.

2. List the variables that appear to be displayed in this visualization.

2 Categorical Variables: 

* Views on extent to which science benefits society (most, some, very few)
* Views on extent to which science benefits people normally (Yes, No, Don't Know, Refused) 

The results are then displayed as a percent of all of those surveyed. 

3. Now that you're versed in the grammar of graphics (ggplot), list the aesthetics used and which variables are specified for each.

* Aesthetics - "Y": Benefiting society, "X": Benefiting people

4. What type of graph would you call this?

This graph visually looks like a simple correlogram/bubble plot however represents density of the respondents who answered a certain way as opposed to correlative relationship between numeric variables. Functionally, the graph matches a treemap the most with the unsure/chose not to answer respondents removed. 

5. List all of the problems or things you would improve about this graph.

* The categories implied by the axis are not clear 
* The specialized naming scheme is confusing
* The survey questions and axis don't seem to mean the same thing
* Axis labels are not centered
* Key not center right

6. Improve the visualization above by either re-creating it with the issues you identified fixed OR by creating a new visualization that you believe tells the same story better.

```{r Load Libraries}
library(tidyverse)
library(leaflet)
library(here)
library(readxl)
library(tidygeocoder)
```

```{r Data Cleaning}
countries <- c("United States", "Egypt", "Morocco", "Lebanon", "Saudi Arabia", "Jordan", "Turkey", "Pakistan", "Indonesia", "Bangladesh", "United Kingdom", "France", "Germany", "Netherlands", "Belgium", "Spain", "Italy", "Poland", "Hungary", "Czech Republic", "Romania", "Sweden", "Greece", "Denmark", "Iran", "Singapore", "Japan", "China", "India", "Venezuela", "Brazil", "Mexico", "Nigeria", "Kenya", "Tanzania", "Israel", "Palestinian Territories", "Ghana", "Uganda", "Benin", "Madagascar", "Malawi", "South Africa", "Canada", "Australia", "Philippines", "Sri Lanka", "Vietnam", "Thailand", "Cambodia", "Laos", "Myanmar", "New Zealand", "Botswana", "Ethiopia", "Mali", "Mauritania", "Mozambique", "Niger", "Rwanda", "Senegal", "Zambia", "South Korea", "Taiwan", "Afghanistan", "Belarus", "Georgia", "Kazakhstan", "Kyrgyzstan", "Moldova", "Russia", "Ukraine", "Burkina Faso", "Cameroon", "Sierra Leone", "Zimbabwe", "Costa Rica", "Albania", "Algeria", "Argentina", "Armenia", "Austria", "Azerbaijan", "Bolivia", "Bosnia and Herzegovina", "Bulgaria", "Burundi", "Chad", "Chile", "Colombia", "Comoros", "Republic of Congo", "Croatia", "Cyprus", "Dominican Republic", "Ecuador", "El Salvador", "Estonia", "Finland", "Gabon", "Guatemala", "Guinea", "Haiti", "Honduras", "Iceland", "Iraq", "Ireland", "Ivory Coast", "Kuwait", "Latvia", "Liberia", "Libya", "Lithuania", "Luxembourg", "Macedonia", "Malaysia", "Malta", "Mauritius", "Mongolia", "Montenegro", "Namibia", "Nepal", "Nicaragua", "Norway", "Panama", "Paraguay", "Peru", "Portugal", "Serbia", "Slovakia", "Slovenia", "Eswatini", "Switzerland", "Tajikistan", "The Gambia", "Togo", "Tunisia", "Turkmenistan", "United Arab Emirates", "Uruguay", "Uzbekistan", "Yemen", "Kosovo", "Northern Cyprus") #Chat GPT took the list from excel and made it a comma separated list, all hail Chat GPT

data_og <- read_xlsx("wgm_data2018.xlsx", sheet = 2) #renamed data set in my files

#Question 1: In general, do you think the work that scientists do benefits people like you in this country?
#Question 2: Overall, do you think that science and technology will help improve life for the next generation?

data_clean <- data_og |> #Changing the Q1 and Q2 values
  select(WP5, Q18, Q19) |>
  mutate(Q18 = case_when(
    Q18 == 1 ~ "Yes",
    Q18 == 2 ~ "No",
    Q18 == 98 ~ "DK",
    Q18 == 99 ~ "R")
    ) |>
  mutate(Q19 = case_when(
    Q19 == 1 ~ "Yes",
    Q19 == 2 ~ "No",
    Q19 == 98 ~ "DK",
    Q19 == 99 ~ "R")
    ) |>
  filter(Q18 %in% c("Yes", "No"),
         Q19 %in% c("Yes", "No")) |>
  rename("Country" = WP5, "Q1" = Q18, "Q2" = Q19) |>
  mutate(`Country` = countries[`Country`])

data_clean <- data_clean |> #importing country names and adding the combo column, case_when() wasn't working, sorry for ifelse spam
  mutate (Combo = ifelse(`Q1` %in% "Yes" & `Q2` %in% "Yes", "Benefits People Like Respondant and ", 99),
          Combo = ifelse(`Q1` %in% "Yes" & `Q2` %in% "No", 2, Combo),
          Combo = ifelse(`Q1` %in% "No" & `Q2` %in% "Yes", 3, Combo),
          Combo = ifelse(`Q1` %in% "No" & `Q2` %in% "No", 4, Combo))

```

```{r Applying Geocode to each country}
data_clean_geo <- data_clean |> #Getting Geocode data for each country
  geocode(country = `Country`)
```

```{r Leaflet Map} 
data_clean <- data_clean_geo |> #to limit the number of obs during testing of leaflet
  distinct(Country, Combo, long, lat)

leaflet() |> 
  addTiles() |>
  addCircles(lng = data_clean$long, lat = data_clean$lat, radius = 10, popup = data_clean$Combo)


```

# NILS CODE ENDS HERE, PLEASE CUT DOWN

**1. While there are certainly issues with this image, do your best to tell the story of this graph in words. That is, what is this graph telling you? What do you think the authors meant to convey with it?**

The graph seems to show a plot of proportions of people who believe vaccines are safe per country. And each the plot seems to be separated by region, with certain countries being labeled. For each plot, there is a line within the plots, showing the median per each region. 

**2. List the variables that appear to be displayed in this visualization.**

The variables in this visualization are countries, region of that country, and % of people who believe vaccines are safe per country.

**3. Now that you're versed in the grammar of graphics (ggplot), list the aesthetics used and which variables are specified for each.**

The different regions are separated by the color of the points. Some of the countries are labeled. And the median of % of people who believe vaccines are safe per region is represented by a line within the plots.  

**4.  What type of graph would you call this?**

This wouldn't really be a scatter plot, as scatter plots take quantitative variables for both x and y. I would call this a segmented bar plot with points instead of bars. Each point represents a quantitative value for each country, which is what a bar plot should do. An argument could also be made that this visualization is multiple box plots, where we are creating box plots for each region. As the median is represented like a boxplot, and we have a decent tell of the spread. The only issue is, there are no boxes.  

**5.  List all of the problems or things you would improve about this graph.**

* No need for axis labels on both the top and bottom.
* y-axis really doesn't represent anything, so there's no need for increasing heights within each region.
* Really weird choice of graph in general. Something like this would be better represented by a box plot.
* Double labeling of colors; no need of a legend.
* Grid lines look off. They should be connecting between each section.

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

```{r libaries}
library(tidyverse)
library(readxl)
library(ggthemes)
```

```{r readxl}
df_world <- read_excel(here::here("wgm2018-dataset-crosstabs-all-countries.xlsx"), sheet = 2)
```

```{r head}
head(df_world)
```

```{r dplyr}
plt <- df_world %>%
  filter(Q23 == 1) %>%
  group_by(WP5) %>%
  summarize(vacc_agree = sum(Q25 %in% c(1, 2)), 
            total = n(), 
            Regions_Report) %>%
  filter(row_number() == 1,
         Regions_Report != 0) %>%
  mutate(prop = vacc_agree/total * 100,
         region = case_when(
           Regions_Report %in% c(1, 2, 4, 5) ~ "Sub-Saharan Africa", 
           Regions_Report %in% c(6:8) ~ "Americas",
           Regions_Report %in% c(9:12) ~ "Asia",
           Regions_Report %in% c(3, 13) ~ "Middle East and North Africa",
           Regions_Report %in% c(14:18) ~ "Europe and Oceania")
         )
```

```{r ggplot}
ggplot(plt, aes(x = prop, y = region, fill = region)) +
  geom_boxplot() +
  geom_text(subset(plt, WP5 == 29), 
            mapping = aes(label = "Japan"),
            vjust = 2,
            size = 3) +
  labs(title = "Boxplots of % of people who believe \nvaccines are safe, \nby global region",
       x = "Percentages",
       y = "") +
  theme_economist() +
  theme(legend.position = "none") 
```
