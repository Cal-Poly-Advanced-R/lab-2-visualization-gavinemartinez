---
title: "Lab 2 Advanced Data Visualization"
author: "Gavin Martinez"
date: "2023-04-13"
output: html_document
---

## Part 1: Identifying Bad Visualizations

### Dissecting a Bad Visualization

1.  While there are certainly issues with this image, do your best to tell the story of this graph in words. That is, what is this graph telling you? What do you think the authors meant to convey with it?

    **The graph is trying to show the percentage of people that believe vaccines are safe. Each facet is a region. Each point within a region represents a country within that region. The x-axis represents percentage points, and the bold vertical line for each region is the median percentage of citizens that believe vaccines are safe. The authors most likely meant to convey the difference in the variability of vaccine acceptance from region to region as well as variability from country to country within the region. There seemed to be an attempt to convey something by making each region its own pane, but it is not quite clear what that is by looking at the plot.**

2.  List the variables that appear to be displayed in this visualization.

    **The variables that appear to be displayed in this visualization are region, country, percentage of citizens within each country that believe vaccines are safe, and median percentage of citizens that believe vaccines are safe among countries within a given region.**

3.  Now that you're versed in the grammar of graphics (ggplot), list the aesthetics used and which variables are specified for each.

    **x = percentage of citizens within each country that believe vaccines are safe.**

    **y = index of country**

    **fill = region**

4.  What type of graph would you call this?

    **I would call this a faceted scatter plot by region of percentage of citizens within each country that believe vaccines are safe by their sorted index.**

5.  List all of the problems or things you would improve about this graph.

    -   **no meaningful y-axis**

    -   **redundant legend**

    -   **crowded visualizations**

### Improving the Bad Visualization

```{r data and libraries}
library(tidyverse)
library(here)
library(magrittr)
library(gganimate)

vac <- read_csv(here('vaccines.csv'))
```

```{r}
vac %<>%
  mutate(country = factor(x = WP5, levels = unique(WP5), labels = c("United States", "Egypt", "Morocco", "Lebanon", "Saudi Arabia", "Jordan", "Turkey", "Pakistan", "Indonesia", "Bangladesh", "United Kingdom", "France", "Germany", "Netherlands", "Belgium", "Spain", "Italy", "Poland", "Hungary", "Czech Republic", "Romania", "Sweden", "Greece", "Denmark", "Iran", "Singapore", "Japan", "China", "India", "Venezuela", "Brazil", "Mexico", "Nigeria", "Kenya", "Tanzania", "Israel", "Palestinian Territories", "Ghana", "Uganda", "Benin", "Madagascar", "Malawi", "South Africa", "Canada", "Australia", "Philippines", "Sri Lanka", "Vietnam", "Thailand", "Cambodia", "Laos", "Myanmar", "New Zealand", "Botswana", "Ethiopia", "Mali", "Mauritania", "Mozambique", "Niger", "Rwanda", "Senegal", "Zambia", "South Korea", "Taiwan", "Afghanistan", "Belarus", "Georgia", "Kazakhstan", "Kyrgyzstan", "Moldova", "Russia", "Ukraine", "Burkina Faso", "Cameroon", "Sierra Leone", "Zimbabwe", "Costa Rica", "Albania", "Algeria", "Argentina", "Armenia", "Austria", "Azerbaijan", "Bolivia", "Bosnia/Herzegovina", "Bulgaria", "Burundi", "Chad", "Chile", "Colombia", "Comoros", "Republic of Congo", "Croatia", "Cyprus", "Dominican Republic", "Ecuador", "El Salvador", "Estonia", "Finland", "Gabon", "Guatemala", "Guinea", "Haiti", "Honduras", "Iceland", "Iraq", "Ireland", "Ivory Coast", "Kuwait", "Latvia", "Liberia", "Libya", "Lithuania", "Luxembourg", "Macedonia", "Malaysia", "Malta", "Mauritius", "Mongolia", "Montenegro", "Namibia", "Nepal", "Nicaragua", "Norway", "Panama", "Paraguay", "Peru", "Portugal", "Serbia", "Slovakia", "Slovenia", "Eswatini", "Switzerland", "Tajikistan", "The Gambia", "Togo", "Tunisia", "Turkmenistan", "United Arab Emirates", "Uruguay", "Uzbekistan", "Yemen", "Kosovo", "Northern Cyprus")),
         response = ifelse(Q25 %in% c(1:2), "yes", "no"))

vac2 <- vac %>%
  select(WP5, country, response, Regions_Report) %>%
  group_by(country) %>% 
  mutate(Percent = sum(response == "yes")/n(),
         country = forcats::fct_reorder(country, -Percent))
  
```

# Part Two: Broad Visualization Improvement (200 points)

The full Wellcome Global Monitor 2018 report can be found here: [[https://wellcome.ac.uk/sites/default/files/wellcome-global-monitor-2018.pdf](https://wellcome.ac.uk/sites/default/files/wellcome-global-monitor-2018.pdf).](https://wellcome.ac.uk/sites/default/files/wellcome-global-monitor-2018.pdf](https://wellcome.ac.uk/sites/default/files/wellcome-global-monitor-2018.pdf).) Surprisingly, the visualization above does not appear in the report despite the citation in the bottom corner of the image!

For the work below, you must use leaflet at least once. You must also use one of the other packages mentioned this week. More specifically, you cannot just use ggplot for the remainder of the lab assignment.

**Second Data Visualization Improvement**

**1. Select a data visualization in the report that you think could be improved. Be sure to cite both the page number and figure title. Do your best to tell the story of this graph in words. That is, what is this graph telling you? What do you think the authors meant to convey with it?**

*The plot that I think could be improved is th eon titled "People seeking science information by region and internet access" on page 37. The graph is trying to show the proportion of citizens in each country surveyed that has responded yes to whether they have internet access, sought science information and have internet access, or sought science information and does not have internet access. It seems the authors meant to highlight the difference in internet access and willingness to search the internet from country to country.*

**2. List the variables that appear to be displayed in this visualization.**

*The variables that are displayed are country, and percentage of citizens within each country that answered yes for each of the three respective questions.*

**3. Now that you're versed in the grammar of graphics (ggplot), list the aesthetics used and which variables are specified for each.**

x = percentage, group = question, fill = question

**4. What type of graph would you call this?**

Bar plot

**5. List all of the problems or things you would improve about this graph.**
It is hard to see which country is overall better or has the highest percentage for each question at first glance.

**6. Improve the visualization above by either re-creating it with the issues you identified fixed OR by creating a new visualization that you believe tells the same story better.**

```{r data}
questions <- data.frame(country = rep(c("World", "Eastern Africa", "Central Africa", "North Africa", "Southern Africa", "Western Africa", "Central America & Mexico", "Northern America", "South America", "Central Asia", "East Asia", "Southeast Asia", "South Asia", "Middle East", "Eastern Europe", "Northern Europe", "Southern Europe", "Western Europe", "AUS & NZ"), each = 3),
                        question = rep(c("Has internet access", "Sought health info & has internet access", "Sought health info & does not have internet access"), times = 19),
                        proportion = c(.54,.52,.28,.24,.56,.35,.27,.60,.40,.48,.47,.23,.46,.43,.34,.34,.46,.29,.55,.52,.34,.91,.74,.38,.62,.51,.33,.55,.42,.34,.67,.51,.3,.46,.46,.27,.25,.35,.22,.72,.58,.38,.74,.47,.33,.91,.59,.38,.82,.61,.47,.9,.63,.51,.93,.66,.31))

questions %<>%
  mutate(rank = rank(-proportion, ties.method = 'random'))
```

```{r}
p.static <- ggplot(questions, aes(rank, group = country,
                fill = as.factor(country), color = as.factor(country))) +
  geom_tile(aes(y = proportion/2,
                height = proportion,
                width = .9), alpha = 0.8, color = NA) +
  geom_text(aes(y = 0, label = paste(country, " ")), vjust = 0.2, hjust = 1, size = 6) +
  geom_text(aes(y = proportion, label = proportion, hjust = 0), size = 6) +
  coord_flip(clip = "off", expand = FALSE) +
  scale_y_continuous(labels = scales::comma) +
  scale_x_reverse() +
  guides(color = FALSE, fill = FALSE) +
  theme(axis.line = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none",
        panel.background = element_blank(),
        panel.border = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.grid.major.x = element_line(size = 0.1, color = "black"),
        panel.grid.minor.x = element_line(size = 0.1, color = "black"),
        plot.title = element_text(size = 25),
        plot.subtitle = element_text(size=18, face = "italic", color = "black",  hjust = 0.5, vjust = -1),
        plot.background = element_blank(),
        plot.margin = margin(2, 2, 2, 6, "cm"))

anim <- p.static + 
  transition_states(question, transition_length = 4, state_length = 4) +
  labs(title = 'Proportion of citizens that answered yes to: {closest_state}')

animate(anim, 200, fps =5, width = 1200, height = 1000)
```
